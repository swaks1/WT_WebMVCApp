@using Newtonsoft.Json;
@model IEnumerable<WT_WebMVCApp.Models.ExerciseVM>

@{
    ViewData["Title"] = "Index";

    var ExerciseGrouped = Model.GroupBy(ex => ex.Category);
}

<h2 class="text-center">All Exercises</h2>


<script>
    var userExercises = [];
    serializedModel = '@Html.Raw(JsonConvert.SerializeObject(Model))'
    userExercises = JSON.parse(serializedModel);
</script>


@foreach (var group in ExerciseGrouped)
{
    var category = group.Key;
    var ExerciseCategory = System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase(category.ToString().ToLower());

    <div class="row mb-2">
        <div class="col-md-12">
            <h2>@ExerciseCategory</h2>
        </div>

        @foreach (var exercise in group)
        {
            <div class="col-xl-3 col-sm-6 mb-3">
                <div class="card text-secondary bg-light o-hidden h-100">
                    <div class="card-body">
                        <div class="card-body-icon">
                            <img style="height:100px;width:100px" class="rounded-circle img-responsive" src="@exercise.ImagePath" />
                        </div>
                        <div class="mr-5">
                            <h3 class="text-capitalize">@exercise.Name</h3>
                            <hr />

                            <blockquote class="blockquote">
                                <p class="mb-0">@exercise.Description</p>
                            </blockquote>

                            <hr />

                            @foreach (var attribute in exercise.Attributes)
                            {
                                <span class="badge badge-pill badge-secondary" data-toggle="tooltip" data-placement="top" title="@attribute.AttributeValue">
                                    @attribute.AttributeName
                                </span>
                            }
                        </div>
                    </div>
                    <a class="card-footer text-primary clearfix small z-1" href="#" data-exerciseId="@exercise.ID">
                        <span class="float-left">Edit </span>
                        <span class="float-right">
                            <i class="fa fa-angle-right"></i>
                        </span>
                    </a>
                </div>
            </div>
        }

    </div>
}

@Html.Partial("_ExerciseModal.cshtml")

@section Scripts
    {
    <script>
        $(function () {
            //console.log(userExercises);

            $(".card-footer").on("click", function () {

                //populate the modal
                var exerciseId = $(this).attr("data-exerciseId");
                var exercise = userExercises.filter(function (item) {
                    return item.ID == exerciseId;
                })[0];
                console.log(exercise);

                $("#exerciseModalLabel").text("Edit Exercise");
                $("#ExerciseId").val(exercise.ID);
                $("#Name").val(exercise.Name);
                $("#Description").val(exercise.Description);
                $("#Category").val(exercise.Category);
                $("#previewImage").attr("src", exercise.ImagePath).show();

                $("#AttributeHolder").empty();
                $.each(exercise.Attributes, function (index, item) {
                    var clone = $(".clonableRow").clone();
                    $(clone).removeClass("clonableRow");
                    $(clone).addClass("AttributeInstance");
                    $(clone).find(".AttributeId").first().val(item.ID);
                    $(clone).find(".AttributeNameSpan").first().text(item.AttributeName);
                    $(clone).find(".AttributeNameInput").first().val(item.AttributeName);
                    $(clone).find(".AttributeValue").first().val(item.AttributeValue);
                    $(clone).show();
                    $(clone).appendTo("#AttributeHolder");
                });
                $("#exerciseModal").modal("show");
            });

        });
    </script>
}




